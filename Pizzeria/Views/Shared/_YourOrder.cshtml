@inject Pizzeria.Services.CartService CartService

<h2>YOUR ORDER</h2>
<br />



@{
    var cart = CartService.GetCart();
    var ingTotalPrice = cart != null ? @CartService.AddIngTotalPrice(@CartService.GetCartItemIng(cart.CartId)) : 0;
}

@{
    <table style="width:100%">
        <tr style="border:double">
            <td style="width:60%;padding-left:5px"><h4>Total</h4></td>
            <td style="width:30%"><h4>@CartService.CalculateTotal(ingTotalPrice)  kr</h4></td>
            <td style="width:10%;padding-right:5px">
                @if (cart != null)
                {
                    @if (cart.CartItems == null || !cart.CartItems.Any())
                    {
                        <input type="submit" class="pay" disabled value="Pay" style="border:double;background:none;">
                    }
                    else
                    {
                        <input type="submit" class="pay" value="Pay" name="pay-@cart.CartId" style="border:double;background:none;">
                    }
                }
                else
                {
                    <input type="submit" class="pay" disabled value="Pay" style="border:double;background:none;" >
                }

            </td>
        </tr>
    </table>
    <table style="margin-top:10px;width:100%">
        <tr>
            <td style="width:80%;padding-left:5px"><h5 style="padding-top:0;padding-bottom:5px;margin:0">Additional ingredients total</h5></td>
            <td style="width:20%"><h5 style="padding-top:0;padding-bottom:5px;margin:0">(@ingTotalPrice kr)</h5> </td>
        </tr>
    </table>
    <br />

    if (cart != null)
    {
        if (cart.CartItems != null)
        {
            foreach (var item in cart.CartItems.OrderBy(x => x.Dish.Name))
            {
                <table style="width:100%">
                    <tr style="border-top:solid;border-width:thin" >
                        <td style="width:40%;padding-left:5px;padding-top:5px;">@item.Dish.Name</td>
                        <td style="width:25%;padding-top:5px;"> @item.Dish.Price  kr</td>
                        <td style="width:10%;padding-top:5px;">x  @item.Quantity</td>
                        <td style="width:5%;padding-top:5px;">
                            <button type="submit" class="customize" name="customize-@item.CartItemId" style="background:none; border:none;">
                                <span class="glyphicon glyphicon-cog" title="Customize"></span>
                            </button>
                        </td>
                        <td style="width:5%;padding-top:5px;">
                            <button type="submit" class="remove" name="remove-@item.CartItemId" style="background:none; border:none;">
                                <span class="glyphicon glyphicon-trash" title="Remove"></span>
                            </button>
                        </td>
                    </tr>
                </table>

                @if (item.CartItemIngredients.Any())
                    {
                    <table style="width:100%">
                        <tr >
                            <td style="padding-left:5px;width:80%">                        
                                    <h6  style="padding-top:0;padding-bottom:5px;margin:0"> + @string.Join(",  ", @CartService.GetCartItemIngName(item.CartItemId))</h6>                                    
                            </td>
                            <td style="width:20%"><h6 style="padding-top:0;padding-bottom:5px;margin:0;float:right">(+ @CartService.AddIngPrice(item.CartItemIngredients.Select(x => x.Ingredient).ToList(), item.Quantity) kr)</h6></td>
                        </tr>
                    </table>
                    }
                }
            @*<table style="margin-top:10px;width:100%">
                    <tr style="border-top:double">
                    <td style="width:80%">Additional ingredients</td>
                    <td style="width:20%;">
                        +  @ingTotalPrice kr
                    </td>
                </tr>
            </table>*@
        }

            @*<table style="width:100%">
                <tr>
                    <td style="width:70%"></td>
                    <td style="width:20%">
                        <button type="submit" class="pay" name="pay-@cart.CartId">
                            Pay
                        </button>
                    </td>
                </tr>
            </table>*@
    }

}



@*@{
        var cartItem = CartService.GetCartItem();
    }
      @if (cartItem != null)
      {
          foreach (var item in cartItem)
          {  <h1>
        @item.Dish.Name
    </h1>
          }
      }*@


@*<ul>
        @{
            var cart = CartService.GetCartForCurrentSession(Context.Session).Result;
        }
        @if (cart != null)
        {
            var total = CartService.CalculateTotal(cart.CartId);
            <ul>

                @foreach (var ci in cart.Items)
                {
                    <li>
                        @ci.Dish.Description @ci.Dish.Price
                        <button type="submit" class="remove" name="customize-@ci.CartItemId">
                            <span class="glyphicon glyphicon-adjust" title="Customize"></span>
                        </button>
                        <button type="submit" class="customize" name="remove-@ci.CartItemId">
                            <span class="glyphicon glyphicon-trash" title="Remove"></span>
                        </button>
                    </li>
                }
            </ul>
        }
    </ul>*@



@*@if (cart.Items.Count > 0)
    {
        <h4>Total</h4>
    }*@
